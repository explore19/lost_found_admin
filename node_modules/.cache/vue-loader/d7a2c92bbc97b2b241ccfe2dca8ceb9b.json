{"remainingRequest":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\src\\views\\task\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\src\\views\\task\\index.vue","mtime":1574219173433},{"path":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\工作2\\新建文件夹 (2)\\autoComplete\\vue-admin-template\\vue-admin-template\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapGetters } from 'vuex'\nimport {getBook,getSchedule,makeQuestion} from '@/api/uschool'\nimport { async } from 'q'\nexport default {\n  name: 'Task',\n  data() {\n    return {\n      data:[],\n      schedule:[],\n      visible1: true,\n      activeNames: '',\n      user: {\n        user_invited_tick: 0,\n        coin: 0,\n        name:''\n      },\n      percentage: 0,\n      status: ''\n    }\n  },\n  created() {\n    this.requestData()\n    getBook().then((res)=>{\n      let list=res.data.all_course_list\n      let data=[]\n      for(let i=0;i<list.length;i++){\n        let url = list[i].hideurl\n         data.push({\n            active_status:list[i].active_status,\n            bookname:list[i].bookname,\n            courseId:this.getQueryVariable(url,'courseId'),\n            school_id:this.getQueryVariable(url,'school_id'),\n            eccId:this.getQueryVariable(url,'eccId'),\n            classId:this.getQueryVariable(url,'classId'),\n            mycouse_id:list[i].mycouse_id\n         })\n      }\n      this.data=data\n  //     data.map((item,index) =>{\n  //     console.log(index)\n  //       getSchedule({\n  //       course_id:item.courseId,\n  //       school_id:item.school_id,\n  //       ecc_id:item.eccId,\n  //       class_id:item.classId,\n  //     }).then(res =>{\n  //       this.schedule[index]=res.data.rs.stuTutorialPerformance.tutorialUnits\n  //     })\n  //  })\n    })\n\n\n\n  },\n  computed: {\n    ...mapGetters([\n      'coin',\n      'name'\n    ])\n  },\n  methods: {\n    handleWriting(couse_id, unit,book_name) {\n      this.$confirm('确定开启第' + unit + '单元任务,将消耗15金币(请在开启任务前认真阅读下面公告)', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        center:true\n      }).then(() => {\n        this.percentage = 0\n        makeQuestion({\n          mycourse_id: couse_id,\n          unit: unit,\n          info:{\n            unit:unit,\n            book_name:book_name\n          }\n        }).then(res => {\n          if (res.status == 1) {\n            this.$message({ message: '任务添加成功,请在任务记录查看进度', type: 'success' })\n            this.requestData()\n          } else if (res.status == 0) {\n            this.$message({ message: res.data ,type: 'warning' })\n          } else {\n            this.visible1 = false\n            this.$message.error('服务器异常，请稍后再试')\n          }\n        })\n      }).catch(() => {\n      })\n    },\n    requestData() {\n      this.$store.dispatch('user/getCoin')\n    },\n    getQueryVariable(url,variable) {\n      let query = url.split(\"?\")[1];\n      let vars = query.split('&')\n      for (let i = 0; i < vars.length; i++) {\n        let pair = vars[i].split('=')\n        if (pair[0] == variable) {\n          return pair[1]\n        }\n      }\n      return ''\n    },\n handleChange(index){\n   console.log(index)\n      if(this.data[index]){\n        if(this.schedule.some(item =>item.index===index)){\n          return\n        }\n     getSchedule({\n        course_id:this.data[index].courseId,\n        school_id:this.data[index].school_id,\n        ecc_id:this.data[index].eccId,\n        class_id:this.data[index].classId,\n      }).then(res =>{\n        this.schedule.push({\n          index:index,\n          data:res.data.rs.stuTutorialPerformance.tutorialUnits\n          })\n      })\n\n      }\n    },\n    getPercentage(index,index2){\n      let percentage =0\n      this.schedule.map((item)=>{\n        if(item.index===index){\n          percentage =item.data[index2].unitProgress\n          return\n        }\n      })\n      return percentage\n    },\n    getScore(index,index2){\n      let score =0\n      this.schedule.map((item)=>{\n        if(item.index===index){\n          score =item.data[index2].unitScore\n          return\n        }\n      })\n      return score\n    }\n  }\n}\n",null]}